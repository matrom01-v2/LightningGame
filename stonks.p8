pico-8 cartridge // http://www.pico-8.com
version 36
__lua__
--game code
--testing push

map_x=0
building_x=0
skyscrp_x=0
map_speed=1
bldng_speed=0.5
skyscrp_speed=0.25
trap_update = 48
trap_spd =1
trap_x=0

function _update60()

				player_update()
				print("player.dx = " .. player.dx)
    map_x-=map_speed
    if map_x<-127 then 
    	map_x=0
    end
    
    trap_x-=trap_spd
    if trap_x<-127 then 
    	trap_x=0
    	trap_update = trap_update +16
    end
    

    --buildings
    building_x-=bldng_speed
    if building_x<-127 then 
    	building_x=0
    end

    --skyscrap
    skyscrp_x-=skyscrp_speed
    if skyscrp_x<-127 then 
    	skyscrp_x=0
    	
    end
end


function _draw()
    cls(1)
    map(32,0,skyscrp_x,0,16,16)
    map(32,0,skyscrp_x+128,0,16,16)
    map(16,0,building_x,0,16,16)
    map(16,0,building_x+128,0,16,16)
    map(0,0,map_x,0,16,16)
    map(0,0,map_x+128,0,16,16)
    map(trap_update,0,trap_x,0,32,16)
    --map(trap_update,0,trap_x+128,0,32,16)
    spr(player.sp,player.x,player.y)
end
-->8
function _init()
  player={
    sp=1,
    x=16,
    y=80,
    w=8,
    h=8,
    dx=0,
    dy=0,
    max_dx=2,
    max_dy=3,
    acc=0.5,
    boost=4,
    jumping=false,
    falling=false,
    landed=false
  }
  gravity=0.4
end


-->8
function player_update()
  --physics
  player.dy+=gravity






  --jump
  if btnp(❎)
  and player.landed then
    player.dy-=player.boost
    player.landed=false
  end

  --check collision up and down
  if player.dy>0 then
    player.falling=true
    player.landed=false
    player.jumping=false

    player.dy=limit_speed(player.dy,player.max_dy)

    if collide_map(player,"down",0) then
      player.landed=true
      player.falling=false
      player.dy=0
      player.y-=((player.y+player.h+1)%8)-1
    end
  elseif player.dy<0 then
    player.jumping=true
    if collide_map(player,"up",1) then
      player.dy=0
    end
  end

  --check collision left and right
  if player.dx<0 then

    player.dx=limit_speed(player.dx,player.max_dx)

    if collide_map(player,"left",2) then
      player.dx=0
    end
  elseif player.dx>0 then

    player.dx=limit_speed(player.dx,player.max_dx)

    if collide_map(player,"right",2) then
      player.dx=0
    end
  end

  

  player.x+=player.dx
  player.y+=player.dy

  
end


function limit_speed(num,maximum)
  return mid(-maximum,num,maximum)
end
-->8
function collide_map(obj,aim,flag)
 --obj = table needs x,y,w,h
 --aim = left,right,up,down

 local x=obj.x  local y=obj.y
 local w=obj.w  local h=obj.h

 local x1=0	 local y1=0
 local x2=0  local y2=0

 if aim=="left" then
   x1=x-1  y1=y
   x2=x    y2=y+h-1

 elseif aim=="right" then
   x1=x+w-1    y1=y
   x2=x+w  y2=y+h-1

 elseif aim=="up" then
   x1=x+2    y1=y-1
   x2=x+w-3  y2=y

 elseif aim=="down" then
   x1=x+2      y1=y+h
   x2=x+w-3    y2=y+h
 end

 --pixels to tiles
 x1/=8    y1/=8
 x2/=8    y2/=8

 if fget(mget(x1,y1), flag)
 or fget(mget(x1,y2), flag)
 or fget(mget(x2,y1), flag)
 or fget(mget(x2,y2), flag) then
   return true
 else
   return false
 end

end
__gfx__
0000000088888888000000000000000000000000bb111111111111bb0909000090000000000000903bb3bb3333b333b300000000000000000000000000000000
00000000800000080000000000000000000000001bb1111111111bb1080000899900008000009008b33b333bb333b33b00000000000000000000000000000000
007007008000000800000000000000000000000011bbbbbbbbbbbb110880998999000000000090883bb33b3b0000000000000000000000000000000000000000
00077000800bb0080000000000000000000000001111111111111111908890899088908090089080544544450000000000000000000000000000000000000000
00077000800bb0080000000000000000000000001111111111111111988899809888998808089988455444540000000000000000000000000000000000000000
007007008000000800000000000000000000000011bbbbbbbbbbbb11989889889898898898988988454445440000000000000000000000000000000000000000
00000000800000080000000000000000000000001bb1111111111bb1889988898899888988998889444544450000000033b333b3000000000000000000000000
0000000088888888000000000000000000000000bb111111111111bb8888888888888888888888885445544400000000b333b33b000000000000000000000000
0000000000000000000000000000000000000000111111d111a111aa767676760000000000000000544544450000000000000000000000000000000000000000
0000000000000000000000000000000000000000d111d111a11aaaaa767676760000000000000000455444540000000000000000000000000000000000000000
0000000000000000000000000000000000000000111111d1aa11a1117c7c7c7c0000000000000000454445440000000000000000000000000000000000000000
0000000000000000000000000000000000000000111111111aa1a11a7c7c7c7c0000000000000000444544450000000000000000000000000000000000000000
000000000000000000000000000000000000000011d1d11d11aa11aa777777770000000000000000544554440000000000000000000000000000000000000000
0000000000000000000000000000000000000000d1111111aa1aaaa17c7c7c7c0000000000000000454545450000000000000000000000000000000000000000
000000000000000000000000000000000000000011d11d11a1a111117c7c7c7c0000000000000000455455440000000000000000000000000000000000000000
000000000000000000000000000000000000000011111111a11aaa11767676760000000000000000544544540000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000600660060000080000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000600660060000050000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000666666660000050000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000666666660000550000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000555555550000550000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000006cc66cc60000550000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000006cc66cc60005550000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000555555550005550000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000666666660005550055555555000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000666666660005550055555555000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000555555550005550055555555000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000666666660055550055555555000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000006cc66cc60055550055555555000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000006cc66cc60055550055555555000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000555555550555555555555555000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000666666665555555555555555000000000000000000000000000000000000000000000000
__gff__
0000000000010100000002020200000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000380000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000390000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000390000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000393800002800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000027000000000000000000000000000000393900003800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000037000000000000000000000000000000393900003900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000001313130000000000000017002727000000000000000000000000393900003900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111110017003737000019000000000000000000393900003900000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111111100111111111111111111111100173c3737000017170000000000000002393902003900000000000000000000000000000000000000000500001a000b000c000000001a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111001111111111000000000000111111110017393737393917170000000000000002393902003900000000000000000000000000000000000a00000500001a00000000000000001a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0605060506050605060506050605060500000000290000000000000000000000000002020002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
15151515151515151515151516151515000000000000003c0000000000000000000002020002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1516151515151615151615151515161500000000000000000000000000000000000002020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1515151615151515151515151515151500000000000000000000000000000000000002020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1615151515151515151615151615151500000000000000000000000000000000000202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1515151515151615151515151515151500000000000000000000000000000002020002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000002020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000002020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
